---
- name: disable default site
  become: yes                                                           
  file: path=/etc/nginx/sites-enabled/default state=absent
      
- name: make sure website folders exist
  become: yes                                                           
  file: state=directory path=/var/www/{{ item }}/html
  with_items: sites

- name: get github website files
  become: yes
  git: repo=https://github.com/jmeridth/{{ item }}.git
       dest=/var/www/{{ item }}/html
  with_items: sites

- name: setup websites
  become: yes
  copy: src={{ item }} dest=/etc/nginx/sites-available/
  with_items: sites

- name: enable websites
  become: yes
  file: src=/etc/nginx/sites-available/{{ item }}
        dest=/etc/nginx/sites-enabled/{{ item }}
        owner=root
        group=root
        state=link
  with_items: sites
  notify:
  - restart nginx
